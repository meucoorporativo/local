<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Localiza√ß√£o e Observa√ß√µes para Excel</title>
  <!-- Biblioteca para exportar Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.19.3/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { margin: 5px; padding: 8px 15px; cursor: pointer; }
    input { padding: 6px; width: 250px; margin-right: 10px; }
    table { border-collapse: collapse; margin-top: 15px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #007BFF; color: white; }
  </style>
</head>
<body>
  <h2>üìç Captura de Localiza√ß√£o com Observa√ß√µes</h2>

  <p><b>Latitude:</b> <span id="lat">-</span></p>
  <p><b>Longitude:</b> <span id="lon">-</span></p>
  <p><b>Altitude (m):</b> <span id="alt">-</span></p>

  <input type="text" id="obs" placeholder="Digite uma observa√ß√£o">
  <button onclick="pegarLocal()">üìå Marcar Local</button>
  <button onclick="salvarExcel()">üíæ Salvar em Excel (.xlsx)</button>

  <h3>Hist√≥rico</h3>
  <table id="tabela">
    <thead>
      <tr>
        <th>Latitude</th>
        <th>Longitude</th>
        <th>Altitude (m)</th>
        <th>Observa√ß√£o</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let registros = [];

    function pegarLocal() {
      let observacao = document.getElementById("obs").value.trim();
      if (observacao === "") {
        alert("Digite uma observa√ß√£o antes de marcar o local.");
        return;
      }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            let lat = pos.coords.latitude.toFixed(6);
            let lon = pos.coords.longitude.toFixed(6);
            let alt = pos.coords.altitude ? pos.coords.altitude.toFixed(2) : "N/D";

            document.getElementById("lat").textContent = lat;
            document.getElementById("lon").textContent = lon;
            document.getElementById("alt").textContent = alt;

            // Adiciona ao hist√≥rico
            registros.push({ Latitude: lat, Longitude: lon, Altitude: alt, Observacao: observacao });
            atualizarTabela(lat, lon, alt, observacao);

            // limpa o campo observa√ß√£o
            document.getElementById("obs").value = "";
          },
          (err) => alert("Erro ao obter localiza√ß√£o: " + err.message)
        );
      } else {
        alert("Seu navegador n√£o suporta geolocaliza√ß√£o.");
      }
    }

    function atualizarTabela(lat, lon, alt, obs) {
      let tbody = document.getElementById("tabela").getElementsByTagName("tbody")[0];
      let row = tbody.insertRow();
      row.insertCell(0).textContent = lat;
      row.insertCell(1).textContent = lon;
      row.insertCell(2).textContent = alt;
      row.insertCell(3).textContent = obs;
    }

    function salvarExcel() {
      if (registros.length === 0) {
        alert("Nenhum local registrado.");
        return;
      }
      // Converte para planilha
      let ws = XLSX.utils.json_to_sheet(registros);
      let wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Localiza√ß√µes");

      // Salva como arquivo .xlsx
      XLSX.writeFile(wb, "localizacoes.xlsx");
    }
  </script>
</body>
</html>
